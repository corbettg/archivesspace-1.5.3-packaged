(function(b){b.fn.drag=function(i,j,k){if(j){this.bind("dragstart",i)}if(k){this.bind("dragend",k)}return !i?this.trigger("drag"):this.bind("drag",j?j:i)};var f=b.event,h=f.special,d=h.drag={not:":input",distance:0,which:1,setup:function(i){i=b.extend({distance:d.distance,which:d.which,not:d.not},i||{});i.distance=c(i.distance);f.add(this,"mousedown",e,i)},teardown:function(){f.remove(this,"mousedown",e);if(this===d.dragging){d.dragging=d.proxy=null}g(this,true)}};function e(j){var k=this,l,i=j.data||{};if(i.elem){k=j.dragTarget=i.elem;j.dragProxy=d.proxy||k;j.cursorOffsetX=i.pageX-i.left;j.cursorOffsetY=i.pageY-i.top;j.offsetX=j.pageX-j.cursorOffsetX;j.offsetY=j.pageY-j.cursorOffsetY}else{if(d.dragging||(i.which>0&&j.which!=i.which)||b(j.target).is(i.not)){return}}switch(j.type){case"mousedown":b.extend(i,b(k).offset(),{elem:k,target:j.target,pageX:j.pageX,pageY:j.pageY});f.add(document,"mousemove mouseup",e,i);g(k,false);return false;case !d.dragging&&"mousemove":if(c(j.pageX-i.pageX)+c(j.pageY-i.pageY)<i.distance){break}j.target=i.target;l=a(j,"dragstart",k);if(l!==false){d.dragging=k;d.proxy=j.dragProxy=b(l||k)[0]}case"mousemove":if(d.dragging){l=a(j,"drag",k);if(h.drop){h.drop.allowed=(l!==false);h.drop.handler(j)}if(l!==false){break}j.type="mouseup"}case"mouseup":f.remove(document,"mousemove mouseup",e);if(d.dragging){if(h.drop){h.drop.handler(j)}a(j,"dragend",k)}g(k,true);d.dragging=d.proxy=i.elem=null;break}}function a(i,k,j){i.type=k;var l=f.dispatch.call(j,i);return l===false?false:l||i.result}function c(i){return Math.pow(i,2)}function g(i,j){if(!i){return}i.unselectable=j?"off":"on";i.onselectstart=function(){return j};if(document.selection&&document.selection.empty){document.selection.empty()}if(i.style){i.style.MozUserSelect=j?"":"none"}}})(jQuery);