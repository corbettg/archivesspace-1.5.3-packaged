$(function(){var k=$("#lcnaf_search");var e=$("#lcnaf_import");var l=$("#results");var a=$("#selected");var d=$("input[name='lcnaf_service']");var b={};var h=function(m){j(m);l.empty();l.append(AS.renderTemplate("template_lcnaf_result_summary",m));$.each(m.records,function(p,n){var o=$(AS.renderTemplate("template_lcnaf_result",{record:n,selected:b}));if(b[n.lccn]){$(".alert-success",o).removeClass("hide")}else{$("button",o).removeClass("hide")}l.append(o)});l.append(AS.renderTemplate("template_lcnaf_pagination",m));$("pre code",l).each(function(n,o){hljs.highlightBlock(o)})};var j=function(m){if(typeof(m.query)==="string"){m.queryString="?family_name="+m.query+"&lcnaf_service="+$("input[name='lcnaf_service']:checked").val()}else{if(m.query.query["local.GivenName"]===undefined){m.query.query["local.GivenName"]=""}m.queryString="?family_name="+m.query.query["local.FamilyName"]+"&given_name="+m.query.query["local.GivenName"]+"&lcnaf_service="+$("input[name='lcnaf_service']:checked").val()}};var g=function(){var m=[];$("[data-lccn]",a).each(function(){m.push($(this).data("lccn"))});return m};var i=function(n){b[n]=false;$("[data-lccn="+n+"]",a).remove();var m=$("[data-lccn="+n+"]",l);if(m.length>0){m.removeClass("hide");$(".alert-success",m).removeClass("alert-success").addClass("alert-info");m.siblings(".alert").addClass("hide")}if(g().length===0){a.siblings(".alert-info").removeClass("hide");$("#import-selected").attr("disabled","disabled")}};var c=function(n,m){b[n]=true;a.append(AS.renderTemplate("template_lcnaf_selected",{lccn:n}));$(".alert-success",m).removeClass("hide");$("button.select-record",m).addClass("hide");$(".alert-info",m).removeClass("alert-info").addClass("alert-success");a.siblings(".alert-info").addClass("hide");$("#import-selected").removeAttr("disabled","disabled")};var f=function(){a.closest(".selected-container").width(a.closest(".col-md-4").width()-30)};k.ajaxForm({dataType:"json",type:"GET",beforeSubmit:function(){if(!$("#family-name-search-query",k).val()){return false}$(".btn",k).attr("disabled","disabled").addClass("disabled").addClass("busy")},success:function(m){$(".btn",k).removeAttr("disabled").removeClass("disabled").removeClass("busy");h(m)},error:function(m){$(".btn",k).removeAttr("disabled").removeClass("disabled").removeClass("busy");var n=m.hasOwnProperty("responseText")?m.responseText.replace(/\n/g,""):"<pre>"+JSON.stringify(m)+"</pre>";AS.openQuickModal(AS.renderTemplate("template_lcnaf_search_error_title"),JSON.stringify(n))}});e.ajaxForm({dataType:"json",type:"POST",beforeSubmit:function(o,m,n){o.push({name:"lcnaf_service",value:$("input[name='lcnaf_service']:checked").val(),});$("#import-selected").attr("disabled","disabled").addClass("disabled").addClass("busy")},success:function(m){$("#import-selected").removeClass("busy");if(m.job_uri){AS.openQuickModal(AS.renderTemplate("template_lcnaf_import_success_title"),AS.renderTemplate("template_lcnaf_import_success_message"));setTimeout(function(){window.location=m.job_uri},2000)}else{$("#import-selected").removeAttr("disabled").removeClass("busy");AS.openQuickModal(AS.renderTemplate("template_lcnaf_import_error_title"),m.error)}},error:function(m){$(".btn",e).removeAttr("disabled").removeClass("disabled").removeClass("busy");var n=m.hasOwnProperty("responseText")?m.responseText.replace(/\n/g,""):"<pre>"+JSON.stringify(m)+"</pre>";AS.openQuickModal(AS.renderTemplate("template_lcnaf_import_error_title"),JSON.stringify(n))}});l.on("click",".lcnaf-pagination a",function(m){m.preventDefault();$.getJSON($(this).attr("href"),function(n){$("body").scrollTo(0);h(n)})}).on("click",".lcnaf-result button.select-record",function(n){var m=$(this).data("lccn");if(b[m]){i(m)}else{c(m,$(this).closest(".lcnaf-result"))}}).on("click",".lcnaf-result button.show-record",function(m){m.preventDefault();$(this).siblings(".lcnaf-marc").removeClass("hide");$(this).addClass("hide")});a.on("click",".remove-selected",function(n){var m=$(this).parent().data("lccn");i(m)});d.on("click",function(m){if(a.children().length>0){m.preventDefault();AS.openQuickModal(AS.renderTemplate("template_lcnaf_service_locked_title"),AS.renderTemplate("template_lcnaf_service_locked_message"))}else{$("#lcnaf_search input.lcnaf-name-input").val("");$("#given-name-search-query").prop("disabled",function(o,n){return !n});$(".btn",".lcnaf-result").prop("disabled",function(o,n){return !n})}});$(window).resize(f);f()});