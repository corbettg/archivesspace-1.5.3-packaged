(function(d){var i={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:false,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:true,theme:null,zindex:999,resultsLimit:null,enableHTML:true,resultsFormatter:function(l){var k=l[this.propertyToSearch];return"<li>"+(this.enableHTML?k:a(k))+"</li>"},tokenFormatter:function(l){var k=l[this.propertyToSearch];return"<li><p>"+(this.enableHTML?k:a(k))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:false,tokenValue:"id",allowFreeTagging:false,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:false,formatQueryParam:function(l,k){return l},caching:true};var f={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"};var h={BEFORE:0,AFTER:1,END:2};var e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:null};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};var g=/[&<>"'\/]/g;function c(k){return String((k===null||k===undefined)?"":k)}function a(k){return c(k).replace(g,function(l){return j[l]})}var b={init:function(k,l){var m=d.extend({},i,l||{});return this.each(function(){d(this).data("settings",m);d(this).data("tokenInputObject",new d.TokenList(this,k,m))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(k){this.data("tokenInputObject").add(k);return this},remove:function(k){this.data("tokenInputObject").remove(k);return this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(k){this.data("tokenInputObject").toggleDisabled(k);return this},setOptions:function(k){d(this).data("settings",d.extend({},d(this).data("settings"),k||{}));return this}};d.fn.tokenInput=function(k){if(b[k]){return b[k].apply(this,Array.prototype.slice.call(arguments,1))}else{return b.init.apply(this,arguments)}};d.TokenList=function(o,y,Z){if(d.type(y)==="string"||d.type(y)==="function"){d(o).data("settings").url=y;var s=D();if(d(o).data("settings").crossDomain===undefined&&typeof s==="string"){if(s.indexOf("://")===-1){d(o).data("settings").crossDomain=false}else{d(o).data("settings").crossDomain=(location.href.split(/\/+/g)[1]!==s.split(/\/+/g)[1])}}}else{if(typeof(y)==="object"){d(o).data("settings").local_data=y}}if(d(o).data("settings").classes){d(o).data("settings").classes=d.extend({},f,d(o).data("settings").classes)}else{if(d(o).data("settings").theme){d(o).data("settings").classes={};d.each(f,function(af,ag){d(o).data("settings").classes[af]=ag+"-"+d(o).data("settings").theme})}else{d(o).data("settings").classes=f}}var L=[];var B=0;var x=new d.TokenList.Cache();var X;var T;var F=d('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",d(o).data("settings").idPrefix+o.id).focus(function(){if(d(o).data("settings").disabled){return false}else{if(d(o).data("settings").tokenLimit===null||d(o).data("settings").tokenLimit!==B){r()}}v.addClass(d(o).data("settings").classes.focused)}).blur(function(){M();d(this).val("");v.removeClass(d(o).data("settings").classes.focused);if(d(o).data("settings").allowFreeTagging){n()}else{d(this).val("")}v.removeClass(d(o).data("settings").classes.focused)}).bind("keyup keydown blur update",l).keydown(function(ag){var ai;var af;switch(ag.keyCode){case e.LEFT:return true;case e.RIGHT:return true;case e.UP:case e.DOWN:if(!d(this).val()){ai=t.prev();af=t.next();if((ai.length&&ai.get(0)===J)||(af.length&&af.get(0)===J)){if(ag.keyCode===e.LEFT||ag.keyCode===e.UP){Q(d(J),h.BEFORE)}else{Q(d(J),h.AFTER)}}else{if((ag.keyCode===e.LEFT||ag.keyCode===e.UP)&&ai.length){aa(d(ai.get(0)))}else{if((ag.keyCode===e.RIGHT||ag.keyCode===e.DOWN)&&af.length){aa(d(af.get(0)))}}}}else{var ah=null;if(ag.keyCode===e.DOWN||ag.keyCode===e.RIGHT){ah=d(V).next()}else{ah=d(V).prev()}if(ah.length){ad(ah)}}return false;case e.BACKSPACE:ai=t.prev();if(!d(this).val().length){if(J){q(d(J));K.change()}else{if(ai.length){aa(d(ai.get(0)))}}return false}else{if(d(this).val().length===1){M()}else{setTimeout(function(){I()},5)}}break;case e.TAB:return true;case e.ENTER:if(V){S(d(V).data("tokeninput"));K.change()}else{d(o).trigger("tokeninput.enter")}ag.stopPropagation();ag.preventDefault();break;case e.NUMPAD_ENTER:case e.COMMA:if(V){S(d(V).data("tokeninput"));K.change()}else{if(d(o).data("settings").allowFreeTagging){n()}ag.stopPropagation();ag.preventDefault()}return false;case e.ESCAPE:M();return true;default:if(String.fromCharCode(ag.which)){setTimeout(function(){I()},5)}break}});var K=d(o).hide().val("").focus(function(){ae(F)}).blur(function(){F.blur()});var J=null;var N=0;var V=null;var v=d("<ul />").addClass(d(o).data("settings").classes.tokenList).click(function(ag){var af=d(ag.target).closest("li");if(af&&af.get(0)&&d.data(af.get(0),"tokeninput")){ac(af)}else{if(J){Q(d(J),h.END)}ae(F)}}).mouseover(function(ag){var af=d(ag.target).closest("li");if(af&&J!==this){af.addClass(d(o).data("settings").classes.highlightedToken)}}).mouseout(function(ag){var af=d(ag.target).closest("li");if(af&&J!==this){af.removeClass(d(o).data("settings").classes.highlightedToken)}}).insertBefore(K);var t=d("<li />").addClass(d(o).data("settings").classes.inputToken).appendTo(v).append(F);var ab=d("<div>").addClass(d(o).data("settings").classes.dropdown).appendTo("body").hide();var R=d("<tester/>").insertAfter(F).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:F.css("fontSize"),fontFamily:F.css("fontFamily"),fontWeight:F.css("fontWeight"),letterSpacing:F.css("letterSpacing"),whiteSpace:"nowrap"});K.val("");var E=d(o).data("settings").prePopulate||K.data("pre");if(d(o).data("settings").processPrePopulate&&d.isFunction(d(o).data("settings").onResult)){E=d(o).data("settings").onResult.call(K,E)}if(E&&E.length){d.each(E,function(af,ag){p(ag);O()})}if(d(o).data("settings").disabled){H(true)}if(d.isFunction(d(o).data("settings").onReady)){d(o).data("settings").onReady.call()}this.clear=function(){v.children("li").each(function(){if(d(this).children("input").length===0){q(d(this))}})};this.add=function(af){S(af)};this.remove=function(af){v.children("li").each(function(){if(d(this).children("input").length===0){var ai=d(this).data("tokeninput");var ag=true;for(var ah in af){if(af[ah]!==ai[ah]){ag=false;break}}if(ag){q(d(this))}}})};this.getTokens=function(){return L};this.toggleDisabled=function(af){H(af)};function k(af){return d(o).data("settings").enableHTML?af:a(af)}function H(af){if(typeof af==="boolean"){d(o).data("settings").disabled=af}else{d(o).data("settings").disabled=!d(o).data("settings").disabled}F.attr("disabled",d(o).data("settings").disabled);v.toggleClass(d(o).data("settings").classes.disabled,d(o).data("settings").disabled);if(J){Q(d(J),h.END)}K.attr("disabled",d(o).data("settings").disabled)}function O(){if(d(o).data("settings").tokenLimit!==null&&B>=d(o).data("settings").tokenLimit){F.hide();M();return}}function l(){if(T===(T=F.val())){return}R.html(a(T));F.width(R.width()+30)}function Y(af){return((af>=48&&af<=90)||(af>=96&&af<=111)||(af>=186&&af<=192)||(af>=219&&af<=222))}function n(){var af=d.trim(F.val());var ag=af.split(d(o).data("settings").tokenDelimiter);d.each(ag,function(aj,ai){if(!ai){return}if(d.isFunction(d(o).data("settings").onFreeTaggingAdd)){ai=d(o).data("settings").onFreeTaggingAdd.call(K,ai)}var ah={};ah[d(o).data("settings").tokenValue]=ah[d(o).data("settings").propertyToSearch]=ai;S(ah)})}function p(ag){var ai=d(d(o).data("settings").tokenFormatter(ag));var af=ag.readonly===true?true:false;if(af){ai.addClass(d(o).data("settings").classes.tokenReadOnly)}ai.addClass(d(o).data("settings").classes.token).insertBefore(t);if(!af){d("<span>"+d(o).data("settings").deleteText+"</span>").addClass(d(o).data("settings").classes.tokenDelete).appendTo(ai).click(function(){if(!d(o).data("settings").disabled){q(d(this).parent());K.change();return false}})}var ah=ag;d.data(ai.get(0),"tokeninput",ag);L=L.slice(0,N).concat([ah]).concat(L.slice(N));N++;C(L,K);B+=1;if(d(o).data("settings").tokenLimit!==null&&B>=d(o).data("settings").tokenLimit){F.hide();M()}return ai}function S(af){var ah=d(o).data("settings").onAdd;if(B>0&&d(o).data("settings").preventDuplicates){var ag=null;v.children().each(function(){var aj=d(this);var ai=d.data(aj.get(0),"tokeninput");if(ai&&ai.id===af.id){ag=aj;return false}});if(ag){aa(ag);t.insertAfter(ag);ae(F);return}}if(d(o).data("settings").tokenLimit===null||B<d(o).data("settings").tokenLimit){p(af);O()}F.val("");M();if(d.isFunction(ah)){ah.call(K,af)}}function aa(af){if(!d(o).data("settings").disabled){af.addClass(d(o).data("settings").classes.selectedToken);J=af.get(0);F.val("");M()}}function Q(ag,af){ag.removeClass(d(o).data("settings").classes.selectedToken);J=null;if(af===h.BEFORE){t.insertBefore(ag);N--}else{if(af===h.AFTER){t.insertAfter(ag);N++}else{t.appendTo(v);N=B}}ae(F)}function ac(ag){var af=J;if(J){Q(d(J),h.END)}if(af===ag.get(0)){Q(ag,h.END)}else{aa(ag)}}function q(ag){var ah=d.data(ag.get(0),"tokeninput");var ai=d(o).data("settings").onDelete;var af=ag.prevAll().length;if(af>N){af--}ag.remove();J=null;ae(F);L=L.slice(0,af).concat(L.slice(af+1));if(af<N){N--}C(L,K);B-=1;if(d(o).data("settings").tokenLimit!==null){F.show().val("");ae(F)}if(d.isFunction(ai)){ai.call(K,ah)}}function C(ah,af){var ag=d.map(ah,function(ai){if(typeof d(o).data("settings").tokenValue=="function"){return d(o).data("settings").tokenValue.call(this,ai)}return ai[d(o).data("settings").tokenValue]});af.val(ag.join(d(o).data("settings").tokenDelimiter))}function M(){ab.hide().empty();V=null}function w(){ab.css({position:"absolute",top:d(v).offset().top+d(v).outerHeight(),left:d(v).offset().left,width:d(v).outerWidth(),"z-index":d(o).data("settings").zindex}).show()}function u(){if(d(o).data("settings").searchingText){ab.html("<p>"+k(d(o).data("settings").searchingText)+"</p>");w()}}function r(){if(d(o).data("settings").hintText){ab.html("<p>"+k(d(o).data("settings").hintText)+"</p>");w()}}var P=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g");function W(af){return af.replace(P,"\\$&")}function A(ag,af){return ag.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+W(af)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(ah,ai){return"<b>"+k(ai)+"</b>"})}function G(ag,ah,af){return ag.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+W(ah)+")(?![^<>]*>)(?![^&;]+;)","g"),A(ah,af))}function U(ah,af){if(af&&af.length){ab.empty();var ag=d("<ul>").appendTo(ab).mouseover(function(ai){ad(d(ai.target).closest("li"))}).mousedown(function(ai){S(d(ai.target).closest("li").data("tokeninput"));K.change();return false}).hide();if(d(o).data("settings").resultsLimit&&af.length>d(o).data("settings").resultsLimit){af=af.slice(0,d(o).data("settings").resultsLimit)}d.each(af,function(ai,aj){var ak=d(o).data("settings").resultsFormatter(aj);ak=G(ak,aj[d(o).data("settings").propertyToSearch],ah);ak=d(ak).appendTo(ag);if(ai%2){ak.addClass(d(o).data("settings").classes.dropdownItem)}else{ak.addClass(d(o).data("settings").classes.dropdownItem2)}if(ai===0){ad(ak)}d.data(ak.get(0),"tokeninput",aj)});w();if(d(o).data("settings").animateDropdown){ag.slideDown("fast")}else{ag.show()}}else{if(d(o).data("settings").noResultsText){ab.html("<p>"+k(d(o).data("settings").noResultsText)+"</p>");w()}}}function ad(af){if(af){if(V){m(d(V))}af.addClass(d(o).data("settings").classes.selectedDropdownItem);V=af.get(0)}}function m(af){af.removeClass(d(o).data("settings").classes.selectedDropdownItem);V=null}function I(){var af=F.val();if(af&&af.length){if(J){Q(d(J),h.AFTER)}if(af.length>=d(o).data("settings").minChars){u();clearTimeout(X);X=setTimeout(function(){z(af)},d(o).data("settings").searchDelay)}else{M()}}}function z(al){var ah=al+D();var af=x.get(ah);if(af){if(d.isFunction(d(o).data("settings").onCachedResult)){af=d(o).data("settings").onCachedResult.call(K,af)}U(al,af)}else{if(d(o).data("settings").url){var aj=D();var ai={};ai.data={};if(aj.indexOf("?")>-1){var am=aj.split("?");ai.url=am[0];var ag=am[1].split("&");d.each(ag,function(an,ap){var ao=ap.split("=");ai.data[ao[0]]=ao[1]})}else{ai.url=aj}ai.data[d(o).data("settings").queryParam]=d(o).data("settings").formatQueryParam(al,ai);ai.type=d(o).data("settings").method;ai.dataType=d(o).data("settings").contentType;if(d(o).data("settings").crossDomain){ai.dataType="jsonp"}ai.success=function(an){if(d(o).data("settings").caching){x.add(ah,d(o).data("settings").jsonContainer?an[d(o).data("settings").jsonContainer]:an)}if(d.isFunction(d(o).data("settings").onResult)){an=d(o).data("settings").onResult.call(K,an)}if(F.val()===al){U(al,d(o).data("settings").jsonContainer?an[d(o).data("settings").jsonContainer]:an)}};d.ajax(ai)}else{if(d(o).data("settings").local_data){var ak=d.grep(d(o).data("settings").local_data,function(an){return an[d(o).data("settings").propertyToSearch].toLowerCase().indexOf(al.toLowerCase())>-1});x.add(ah,ak);if(d.isFunction(d(o).data("settings").onResult)){ak=d(o).data("settings").onResult.call(K,ak)}U(al,ak)}}}}function D(){var af=d(o).data("settings").url;if(typeof d(o).data("settings").url=="function"){af=d(o).data("settings").url.call(d(o).data("settings"))}return af}function ae(af){setTimeout(function(){af.focus()},50)}};d.TokenList.Cache=function(l){var n=d.extend({max_size:500},l);var o={};var m=0;var k=function(){o={};m=0};this.add=function(q,p){if(m>n.max_size){k()}if(!o[q]){m+=1}o[q]=p};this.get=function(p){return o[p]}}}(jQuery));$(function(){$.fn.linker=function(){$(this).each(function(){var h=$(this);var l=h.parents(".linker-wrapper:first");if(h.hasClass("initialised")){return}h.addClass("initialised");$(".prelinker",l).remove();var a={url:decodeURIComponent(h.data("url")),browse_url:decodeURIComponent(h.data("browse-url")),format_template:h.data("format_template"),format_template_id:h.data("format_template_id"),format_property:h.data("format_property"),path:h.data("path"),name:h.data("name"),multiplicity:h.data("multiplicity")||"many",label:h.data("label"),label_plural:h.data("label_plural"),modal_id:h.data("modal_id")||(h.attr("id")+"_modal"),sortable:h.data("sortable")===true,types:h.data("types"),exclude_ids:h.data("exclude")||[]};a.allow_multiple=a.multiplicity==="many";if(a.format_template&&a.format_template.substring(0,2)!="${"){a.format_template="${"+a.format_template+"}"}var i=function(m){var n=$("#"+a.modal_id);var o=function(p){$(".linker-container",n).html(p);$("#createAndLinkButton",n).removeAttr("disabled");$("form",n).ajaxForm({data:{inline:true},beforeSubmit:function(){$("#createAndLinkButton",n).attr("disabled","disabled")},success:function(r,q,s){if($(r).is("form")){o(r)}else{if(a.multiplicity==="one"){e()}h.tokenInput("add",{id:r.uri,name:r.display_string||r.title,json:r});h.triggerHandler("change");n.modal("hide")}},error:function(s,r,q){$("#createAndLinkButton",n).removeAttr("disabled")}});n.scrollTo(".alert");n.trigger("resize");$(document).triggerHandler("loadedrecordform.aspace",[n])};$.ajax({url:m,success:o});$("#createAndLinkButton",n).click(function(){$("form",n).triggerHandler("submit")})};var f=function(){AS.openCustomModal(a.modal_id,"Create "+a.label,AS.renderTemplate("linker_createmodal_template",a),"large",{},this);if($(this).hasClass("linker-create-btn")){i($(this).data("target"))}else{i($(".linker-create-btn:first",l).data("target"))}return false};var j=function(){var o={};var n=function(p){$.each(h.tokenInput("get"),function(){o[this.id]=this.json});$.ajax({url:a.browse_url,data:{page:1,type:a.types,linker:true,exclude:a.exclude_ids,multiplicity:a.multiplicity},type:"GET",dataType:"html",success:function(s){var r=$("#"+a.modal_id);var t=$(".linker-container",r);var q=function(){$(":input[name=linker-item]",t).each(function(){var u=$(this);u.click(function(v){v.stopPropagation();if(!a.allow_multiple){o={};$("tr.selected",u.closest("table")).removeClass("selected")}if(o.hasOwnProperty(u.val())){delete o[u.val()];u.closest("tr").removeClass("selected")}else{o[u.val()]=u.data("object");u.closest("tr").addClass("selected")}});$("td",u.closest("tr")).click(function(v){v.preventDefault();u.trigger("click")})});$.each(o,function(u){$(":input[value='"+u+"']",t).attr("checked","checked").closest("tr").addClass("selected")});r.trigger("resize")};t.html(s);$(t).on("click","a",function(u){u.preventDefault();t.load(u.target.href,q)});$(t).on("submit","form",function(v){v.preventDefault();var u=$(v.target);var w=(u.attr("method")||"get").toUpperCase();if(w=="POST"){jQuery.post(u.attr("action")+".js",u.serializeArray(),function(x){t.html(x);q()})}else{t.load(u.attr("action")+".js?"+u.serialize(),q)}});q()}})};var m=function(){selectedItems=[];$(".token-input-delete-token",l).each(function(){$(this).triggerHandler("click")});$.each(o,function(q,p){h.tokenInput("add",{id:q,name:p.display_string||p.title,json:p})});$("#"+a.modal_id).modal("hide");h.triggerHandler("change")};AS.openCustomModal(a.modal_id,"Browse "+a.label_plural,AS.renderTemplate("linker_browsemodal_template",a),"large",{},this);n();$("#"+a.modal_id).on("click","#addSelectedButton",m);$("#"+a.modal_id).on("click",".linker-list .pagination .navigation a",function(){n($(this).attr("rel"))});return false};var g=function(o){var n=[];var m=[];$.each(h.tokenInput("get"),function(p){m.push(p.id)});$.each(o.search_data.results,function(p,q){if($.inArray(q.uri,m)===-1){n.push({name:q.display_string||q.title,id:q.id,json:q})}});return n};var b=function(){$(".linker-browse-btn",l).on("click",j);$(".linker-create-btn",l).on("click",f);l.one("mouseenter focus",".has-popover",function(){$(document).triggerHandler("init.popovers",[h.parent()])})};var e=function(){var o=$(".token-input-list",h.parent());for(var n=0;n<h.tokenInput("get").length;n++){var m=h.tokenInput("get")[n].id.replace(/\//g,"_");$("#"+m+" :input",o).remove()}h.tokenInput("clear")};var d=function(){if($(".token-input-list",l).data("sortable")){$(".token-input-list",l).sortable("destroy")}$(".token-input-list",l).sortable({items:"li.token-input-token"});$(".token-input-list",l).off("sortupdate").on("sortupdate",function(){h.parents("form:first").triggerHandler("formchanged.aspace")})};var c=function(){if(h.data("multiplicity")==="one"){if($.isEmptyObject(h.data("selected"))){return[]}return[{id:h.data("selected").uri,name:h.data("selected").display_string||h.data("selected").title,json:h.data("selected")}]}else{if(!h.data("selected")||h.data("selected").length===0){return[]}return h.data("selected").map(function(m){return{id:m.uri,name:m.display_string||m.title,json:m}})}};var k=function(){var m=$.extend({},AS.linker_locales,{animateDropdown:false,preventDuplicates:true,allowFreeTagging:false,tokenLimit:(a.multiplicity==="one"?1:null),caching:false,onCachedResult:g,onResult:g,zindex:1100,tokenFormatter:function(o){var n=$(AS.renderTemplate("linker_selectedtoken_template",{item:o,config:a}));$("input[name*=resolved]",n).val(JSON.stringify(o.json));return n},resultsFormatter:function(p){var o=p.name;var n=$("<span class='"+p.json.jsonmodel_type+"'>");n.text(o);n.prepend("<span class='icon-token'></span>");var q=$("<li>");q.append(n);return q[0].outerHTML},prePopulate:c(),onDelete:function(){h.triggerHandler("change")},onAdd:function(n){if(a.sortable&&a.allow_multiple){d()}$(document).triggerHandler("init.popovers",[h.parent()])},formatQueryParam:function(p,o){if(h.tokenInput("get").length>0||a.exclude_ids.length>0){var n=$.merge([],a.exclude_ids);$.each(h.tokenInput("get"),function(q,r){n.push(r.id)});o.data["exclude[]"]=n}if(a.types&&a.types.length>0){o.data.type=a.types}return(p+"*").toLowerCase()}});setTimeout(function(){h.tokenInput(a.url,m);$("> :input[type=text]",$(".token-input-input-token",h.parent())).attr("placeholder",AS.linker_locales.hintText);$("> :input[type=text]",$(".token-input-input-token",h.parent())).addClass("form-control");h.parent().addClass("multiplicity-"+a.multiplicity);if(a.sortable&&a.allow_multiple){d();l.addClass("sortable")}});b()};k()})}});$(document).ready(function(){$(document).bind("loadedrecordsubforms.aspace",function(a,b){$(".linker-wrapper:visible > .linker:not(.initialised)",b).linker();$("#archives_tree_toolbar .linker:not(.initialised)").linker()});$(document).bind("subrecordcreated.aspace",function(c,a,b){$(".linker:not(.initialised)",b).linker()})});(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssChildRow:"expand-child",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,sortLocaleCompare:true,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:"/.|,/g",onRenderHeader:null,selectorHeaders:"thead th",debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms")}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s)}else{alert(s)}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug=""}if(table.tBodies.length==0){return}var rows=table.tBodies[0].rows;if(rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter)}else{if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter)}}if(!p){p=detectParserForColumn(table,rows,-1,i)}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n"}list.push(p)}}if(table.config.debug){log(parsersDebug)}return list}function detectParserForColumn(table,rows,rowIndex,cellIndex){var l=parsers.length,node=false,nodeValue=false,keepLooking=true;while(nodeValue==""&&keepLooking){rowIndex++;if(rows[rowIndex]){node=getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex);nodeValue=trimAndGetNodeText(table.config,node);if(table.config.debug){log("Checking if value was empty on row:"+rowIndex)}}else{keepLooking=false}}for(var i=1;i<l;i++){if(parsers[i].is(nodeValue,table,node)){return parsers[i]}}return parsers[0]}function getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex){return rows[rowIndex].cells[cellIndex]}function trimAndGetNodeText(config,node){return $.trim(getElementText(config,node))}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i]}}return false}function buildCache(table){if(table.config.debug){var cacheTime=new Date()}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=$(table.tBodies[0].rows[i]),cols=[];if(c.hasClass(table.config.cssChildRow)){cache.row[cache.row.length-1]=cache.row[cache.row.length-1].add(c);continue}cache.row.push(c);for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c[0].cells[j]),table,c[0].cells[j]))}cols.push(cache.normalized.length);cache.normalized.push(cols);cols=null}if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime)}return cache}function getElementText(config,node){var text="";if(!node){return""}if(!config.supportsTextContent){config.supportsTextContent=node.textContent||false}if(config.textExtraction=="simple"){if(config.supportsTextContent){text=node.textContent}else{if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){text=node.childNodes[0].innerHTML}else{text=node.innerHTML}}}else{if(typeof(config.textExtraction)=="function"){text=config.textExtraction(node)}else{text=$(node).text()}}return text}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){var pos=n[i][checkCell];rows.push(r[pos]);if(!table.config.appender){var l=r[pos].length;for(var j=0;j<l;j++){tableBody[0].appendChild(r[pos][j])}}}if(table.config.appender){table.config.appender(table,rows)}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime)}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd")},0)}function buildHeaders(table){if(table.config.debug){var time=new Date()}var meta=($.metadata)?true:false;var header_index=computeTableHeaderCellIndexes(table);$tableHeaders=$(table.config.selectorHeaders,table).each(function(index){this.column=header_index[this.parentNode.rowIndex+"-"+this.cellIndex];this.order=formatSortingOrder(table.config.sortInitialOrder);this.count=this.order;if(checkHeaderMetadata(this)||checkHeaderOptions(table,index)){this.sortDisabled=true}if(checkHeaderOptionsSortingLocked(table,index)){this.order=this.lockedOrder=checkHeaderOptionsSortingLocked(table,index)}if(!this.sortDisabled){var $th=$(this).addClass(table.config.cssHeader);if(table.config.onRenderHeader){table.config.onRenderHeader.apply($th)}}table.config.headerList[index]=this});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders)}return $tableHeaders}function computeTableHeaderCellIndexes(t){var matrix=[];var lookup={};var thead=t.getElementsByTagName("THEAD")[0];var trs=thead.getElementsByTagName("TR");for(var i=0;i<trs.length;i++){var cells=trs[i].cells;for(var j=0;j<cells.length;j++){var c=cells[j];var rowIndex=c.parentNode.rowIndex;var cellId=rowIndex+"-"+c.cellIndex;var rowSpan=c.rowSpan||1;var colSpan=c.colSpan||1;var firstAvailCol;if(typeof(matrix[rowIndex])=="undefined"){matrix[rowIndex]=[]}for(var k=0;k<matrix[rowIndex].length+1;k++){if(typeof(matrix[rowIndex][k])=="undefined"){firstAvailCol=k;break}}lookup[cellId]=firstAvailCol;for(var k=rowIndex;k<rowIndex+rowSpan;k++){if(typeof(matrix[k])=="undefined"){matrix[k]=[]}var matrixrow=matrix[k];for(var l=firstAvailCol;l<firstAvailCol+colSpan;l++){matrixrow[l]="x"}}}}return lookup}function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++))}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell)}}}return arr}function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true}return false}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true}return false}function checkHeaderOptionsSortingLocked(table,i){if((table.config.headers[i])&&(table.config.headers[i].lockedOrder)){return table.config.headers[i].lockedOrder}return false}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table)}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i]}}}function formatSortingOrder(v){if(typeof(v)!="Number"){return(v.toLowerCase()=="desc")?1:0}else{return(v==1)?1:0}}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true}}return false}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this)}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]])}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$("<colgroup>");$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($("<col>").css("width",$(this).width()))});$(table).prepend(colgroup)}}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date()}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(table.config.parsers[c].type=="text")?((order==0)?makeSortFunction("text","asc",c):makeSortFunction("text","desc",c)):((order==0)?makeSortFunction("numeric","asc",c):makeSortFunction("numeric","desc",c));var e="e"+i;dynamicExp+="var "+e+" = "+s;dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { "}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; "}dynamicExp+="return 0; ";dynamicExp+="}; ";if(table.config.debug){benchmark("Evaling expression:"+dynamicExp,new Date())}eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime)}return cache}function makeSortFunction(type,direction,index){var a="a["+index+"]",b="b["+index+"]";if(type=="text"&&direction=="asc"){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+a+" < "+b+") ? -1 : 1 )));"}else{if(type=="text"&&direction=="desc"){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+b+" < "+a+") ? -1 : 1 )));"}else{if(type=="numeric"&&direction=="asc"){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+a+" - "+b+"));"}else{if(type=="numeric"&&direction=="desc"){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+b+" - "+a+"));"}}}}}function makeSortText(i){return"((a["+i+"] < b["+i+"]) ? -1 : ((a["+i+"] > b["+i+"]) ? 1 : 0));"}function makeSortTextDesc(i){return"((b["+i+"] < a["+i+"]) ? -1 : ((b["+i+"] > a["+i+"]) ? 1 : 0));"}function makeSortNumeric(i){return"a["+i+"]-b["+i+"];"}function makeSortNumericDesc(i){return"b["+i+"]-a["+i+"];"}function sortText(a,b){if(table.config.sortLocaleCompare){return a.localeCompare(b)}return((a<b)?-1:((a>b)?1:0))}function sortTextDesc(a,b){if(table.config.sortLocaleCompare){return b.localeCompare(a)}return((b<a)?-1:((b>a)?1:0))}function sortNumeric(a,b){return a-b}function sortNumericDesc(a,b){return b-a}function getCachedSortType(parsers,i){return parsers[i].type}this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies){return}var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$.data(this,"tablesorter",config);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){$this.trigger("sortStart");var $cell=$(this);var i=this.column;this.order=this.count++%2;if(this.lockedOrder){this.order=this.lockedOrder}if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j])}}}config.sortList.push([i,this.order])}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2}}}else{config.sortList.push([i,this.order])}}setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache))},1);return false}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false}});$this.bind("update",function(){var me=this;setTimeout(function(){me.config.parsers=buildParserCache(me,$headers);cache=buildCache(me)},1)}).bind("updateCell",function(e,cell){var config=this.config;var pos=[(cell.parentNode.rowIndex-1),cell.cellIndex];cache.normalized[pos[0]][pos[1]]=config.parsers[pos[1]].format(getElementText(config,cell),cell)}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache))}).bind("appendCache",function(){appendToTable(this,cache)}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this)}).bind("applyWidgets",function(){applyWidget(this)});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList])}applyWidget(this)})};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false}}if(a){parsers.push(parser)}};this.addWidget=function(widget){widgets.push(widget)};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i};this.isDigit=function(s,config){return/^[-+]?\d*$/.test($.trim(s.replace(/[,.']/g,"")))};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild){this.removeChild(this.firstChild)}}empty.apply(table.tBodies[0])}else{table.tBodies[0].innerHTML=""}}}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true},format:function(s){return $.trim(s.toLocaleLowerCase())},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c)},format:function(s){return $.tablesorter.formatFloat(s)},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[£$€?.]/.test(s)},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[£$€]/g),""))},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s)},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item}else{r+=item}}return $.tablesorter.formatFloat(r)},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s)},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),""))},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s)},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0")},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s))},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""))},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/))},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime())},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s)},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2")}else{if(c.dateFormat=="pt"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1")}else{if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1")}else{if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3")}}}}return $.tablesorter.formatFloat(new Date(s).getTime())},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s)},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime())},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?"sortValue":c.parserMetadataName;return $(cell).metadata()[p]},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date()}var $tr,row=-1,odd;$("tr:visible",table.tBodies[0]).each(function(i){$tr=$(this);if(!$tr.hasClass(table.config.cssChildRow)){row++}odd=(row%2==0);$tr.removeClass(table.config.widgetZebra.css[odd?0:1]).addClass(table.config.widgetZebra.css[odd?1:0])});if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time)}}})})(jQuery);function SpaceCalculatorForContainerLocation(a){this.$btn=a.find(".show-space-calculator-btn");this.$linkerWrapper=this.$btn.closest(".linker-wrapper");this.$linker=this.$linkerWrapper.find(".linker");this.setupEvents()}SpaceCalculatorForContainerLocation.prototype.setupEvents=function(){var a=this;a.$btn.on("click",function(b){new SpaceCalculatorModal({modalInitialContent:a.$btn.data("modal-content"),url:a.$btn.data("calculator-url"),selectable:true,containerProfile:a.getContainerProfileURI(),onSelect:function(c){$(".token-input-delete-token",a.$linkerWrapper).each(function(){$(this).triggerHandler("click")});var e=c.find("#tabledSearchResults :input:checked:first");var d=e.data("object")._resolved;a.$linker.tokenInput("add",{id:e.val(),name:d.title,json:d});a.$linker.triggerHandler("change")}})})};SpaceCalculatorForContainerLocation.prototype.getContainerProfileURI=function(){return $(document).find("[name='top_container[container_profile][ref]']").val()};function SpaceCalculatorForButton(a){a.on("click",function(b){b.preventDefault();new SpaceCalculatorModal({modalInitialContent:a.data("modal-content"),url:a.data("calculator-url"),selectable:a.data("selectable"),containerProfile:a.data("container-profile-uri")})})}function SpaceCalculatorModal(b){var a=this;a.options=b;a.$modal=AS.openCustomModal("spaceCalculatorModal",null,"<div class='alert alert-info'>"+a.options.modalInitialContent+"</div>","large",{},this);$.ajax({url:a.options.url,type:"GET",data:{container_profile_ref:a.options.containerProfile,selectable:a.options.selectable},success:function(c){$(".alert",a.$modal).replaceWith(c);a.setupForm(a.$modal.find("form"));$(window).trigger("resize")},error:function(c,e,d){$(".alert",a.$modal).replaceWith(AS.renderTemplate("modal_quick_template",{message:c.responseText}));$(window).trigger("resize")}})}SpaceCalculatorModal.prototype.setupForm=function(b){var a=this;a.$results=a.$modal.find("#spaceCalculatorResults");a.$modal.find(".linker").linker();a.setupByBuildingSearch();a.$modal.find("#addSelectedButton").attr("disabled","disabled");b.ajaxForm({beforeSubmit:function(){a.$modal.find("#addSelectedButton").attr("disabled","disabled");a.$results.html(AS.renderTemplate("spaceCalculatorLoadingTemplate"))},success:function(c){a.$modal.find("#spaceCalculatorResults").html(c);a.setupResults();a.setupResultsFilter();a.setupResultsToggles()}});a.$modal.find("#byBuilding").on("hide.bs.collapse",function(){a.$modal.find("#byBuilding :input").prop("disabled",true)}).on("show.bs.collapse",function(){a.$modal.find("#byBuilding :input").prop("disabled",false)});a.$modal.find("#byLocation").on("hide.bs.collapse",function(){a.$modal.find("#byLocation :input").prop("disabled",true)}).on("show.bs.collapse",function(){a.$modal.find("#byLocation :input").prop("disabled",false)})};SpaceCalculatorModal.prototype.setupByBuildingSearch=function(){var c=this;var b=c.$modal.find("#building");var d=c.$modal.find("#floor");var e=c.$modal.find("#room");var a=c.$modal.find("#area");b.on("change",function(){d.val("").closest(".form-group").hide();e.val("").closest(".form-group").hide();a.val("").closest(".form-group").hide();if(b.val()!=""){var f=AS.building_data[b.val()];if(!$.isEmptyObject(f)){d.empty();d.append($("<option>"));for(var g in f){d.append($("<option>").html(g))}d.closest(".form-group").show()}}});d.on("change",function(){e.val("").closest(".form-group").hide();a.val("").closest(".form-group").hide();if(d.val()!=""){var g=AS.building_data[b.val()][d.val()];if(!$.isEmptyObject(g)){e.empty();e.append($("<option>"));for(var f in g){e.append($("<option>").html(f))}e.closest(".form-group").show()}}});e.on("change",function(){a.val("").closest(".form-group").hide();if(e.val()!=""){var f=AS.building_data[b.val()][d.val()][e.val()];if(f!=null&&f.length>0){a.empty();a.append($("<option>"));for(var g=0;g<f.length;g++){a.append($("<option>").html(f[g]))}a.closest(".form-group").show()}}})};SpaceCalculatorModal.prototype.setupResults=function(){var b=this;$(":input[name=linker-item]",b.$results).each(function(){var e=$(this);e.click(function(f){f.stopPropagation();$("tr.selected",e.closest("table")).removeClass("selected");e.closest("tr").addClass("selected");b.$modal.find("#addSelectedButton").removeAttr("disabled")});$("td",e.closest("tr")).click(function(f){f.preventDefault();e.trigger("click")})});b.$modal.on("click","#addSelectedButton",function(e){b.options.onSelect&&b.options.onSelect(b.$results);b.$modal.modal("hide")});var c=b.$results.find("#tabledSearchResults");var d=c.find("thead tr:first");var a={sortList:[[d.find(".space").index(),0],[d.find(".count").index(),1]],textExtraction:function(e){var f=$(e);if(f.hasClass("space")){return f.hasClass("success")?0:1}else{if(f.hasClass("count")){return f.data("count")}}return f.text().trim()}};if(b.$results.find(".col.selectable:first")){a.header={"0":false}}c.tablesorter(a)};SpaceCalculatorModal.prototype.setupResultsFilter=function(){var a=this;var d=a.$results.find("#searchResultsFilter");var b;function c(){var e=d.val().match(/\w+|"[^"]+"/g)||[];a.$results.find("#tabledSearchResults tbody tr").each(function(){var j=$(this);var k=j.text();var g=true;for(var h=0;h<e.length;h++){var f=e[h].replace(/\"/g,"");if(f===""){continue}if(!(new RegExp(f,"i")).test(k)){g=false;break}}if(g){j.removeClass("filtered-by-search")}else{j.addClass("filtered-by-search")}})}d.on("keyup",function(){clearTimeout(b);b=setTimeout(c,200)})};SpaceCalculatorModal.prototype.setupResultsToggles=function(){var a=this;var b=a.$results.find(".space-calculator-results-toggle");b.each(function(){var c=$(this);if(c.is(":disabled")){c.closest(".btn").addClass("disabled")}});b.on("click",function(){var c=$(this);var d=a.$results.find(c.data("target-selector"));if(c.is(":checked")){d.removeClass("filtered-by-toggle")}else{d.addClass("filtered-by-toggle")}})};$(document).bind("subrecordcreated.aspace",function(c,a,b){if(a=="container_location"){new SpaceCalculatorForContainerLocation(b)}});$(document).ready(function(){new SpaceCalculatorForButton($("#showSpaceCalculator"))});