$(function(){var d=2000;var i=2000;var a,f;var b=$("#job_status");var h=b.data("current-status");var c=function(){var k=$("#logs");if(typeof k.data("status-poll-interval")!="undefined"){d=parseInt(k.data("status-poll-interval"))}var j=$("#logSpool",k);var m=$(".btn-follow-log",k);if(k.length===0){return}m.on("click",function(){$(this).toggleClass("active")});var n=0;var l=function(){$.ajax({url:k.data("poll-url"),data:{offset:n},type:"GET",success:function(o){var p=o.length;$(".alert",k).remove();j.slideDown();j.append($("<div>").text(o));n+=p;if(p===0){g()}if(h==="running"){a=setTimeout(l,d);if(m.hasClass("active")){j.animate({scrollTop:j[0].scrollHeight})}}else{j[0].scrollTop=j[0].scrollHeight}}})};l()};var e=function(){var k=$("#generated_uris");var l=$("#jobRecordsSpool",k);if(k.length===0){return}var j=function(m){$.ajax({url:m,type:"GET",success:function(n){l.html(n)}})};l.on("click",".pagination a",function(m){m.preventDefault();j($(this).attr("href"))});j(k.data("url"))};var g=function(){$.ajax({url:b.data("poll-url"),type:"GET",dataType:"json",success:function(k){if(h!=k.status){var l=h;h=k.status;var j="template_job_"+k.status+"_notice";var m=$("<li>");m.append(AS.renderTemplate(j));$("#archivesSpaceSidebar .as-nav-list").append(m);if(l==="queued"){location.reload()}if($.inArray(h,["failed","canceled","completed"])>=0){$(".record-toolbar .btn").addClass("disabled").attr("disabled","disabled")}}else{if($.inArray(h,["queued"])>=0){$("#queueMessage").html(k.queue_position_message);f=setTimeout(g,i)}}},error:function(j){console.log(j.responseText)}})};$("#archivesSpaceSidebar").on("click",".btn-refresh",function(){location.reload()});if($.inArray(h,["queued"])>=0){g()}c();e()});