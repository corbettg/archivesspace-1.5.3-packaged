$(function(){var d=10000;var b="stale";var c="opened_for_editing";var e="repository_changed";var a=function(h){if(h.data("update-monitor")==="enabled"){return}h.data("update-monitor","enabled");h.data("update-monitor-paused",false);var i=h.data("update-monitor-url");var j=h.data("update-monitor-lock_version");var k=h.data("update-monitor-record-uri");var g=h.data("update-monitor-record-is-stale");$(document).trigger("clearupdatemonitorintervals.aspace");var m=function(q){$(".record-pane .update-monitor-error",h).remove();if(g||q.status===b){var p=AS.renderTemplate(g?"update_monitor_save_failed_with_stale_record_template":"update_monitor_stale_record_message_template");$("#form_messages",h).prepend(p);$(".record-pane .form-actions",h).prepend(p);$(".btn-primary, .btn-toolbar .btn",h).attr("disabled","disabled").addClass("disabled");clearInterval($(document).data("UPDATE_MONITOR_POLLING_INTERVAL"))}else{if(q.status===c){var n=[];$.each(q.edited_by,function(r,s){n.push(r)});var p=AS.renderTemplate("update_monitor_other_editors_message_template",{user_ids:n.join(", ")});$("#form_messages",h).prepend(p);$(".record-pane .form-actions",h).prepend(p)}else{if(q.status===e){var p=AS.renderTemplate("update_monitor_repository_changed_message_template");$("#form_messages",h).prepend(p);$(".record-pane .form-actions",h).prepend(p)}}}if($(".as-nav-list li.alert-error").length===0){$(".as-nav-list").prepend(AS.renderTemplate("as_nav_list_errors_item_template"))}var o=$(".as-nav-list li.alert-error");if(!o.hasClass("acknowledged")&&$(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL")==null){$(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL",setInterval(function(){o.toggleClass("active")},3000));o.hover(function(){clearInterval($(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL"));o.removeClass("active").addClass("acknowledged")},function(){})}};var f=function(){$(".update-monitor-error",h).remove()};var l=function(){if(g){m();return}if(h.data("update-monitor-paused")==true){return}$.post(i,{lock_version:j,uri:k},function(n,p,o){if(n.status===b||n.status===c||n.status===e){m(n)}else{f()}},"json").fail(function(n,p,o){if(n.status===500||n.status===403){window.location.replace(FRONTEND_URL)}})};l();$(document).data("UPDATE_MONITOR_POLLING_INTERVAL",setInterval(l,d))};$(document).bind("setupupdatemonitor.aspace",function(g,f){a(f)});$(document).bind("clearupdatemonitorintervals.aspace",function(f){clearInterval($(document).data("UPDATE_MONITOR_HIGHLIGHT_INTERVAL"));clearInterval($(document).data("UPDATE_MONITOR_POLLING_INTERVAL"))})});