function BulkContainerSearch(b,c,a){this.$search_form=b;this.$results_container=c;this.$toolbar=a;this.setup_form();this.setup_results_list()}BulkContainerSearch.prototype.setup_form=function(){var a=this;$(document).trigger("loadedrecordsubforms.aspace",this.$search_form);this.$search_form.on("submit",function(b){b.preventDefault();a.perform_search(a.$search_form.serializeArray())})};BulkContainerSearch.prototype.perform_search=function(b){var a=this;a.$results_container.closest(".row").show();a.$results_container.html(AS.renderTemplate("template_bulk_operation_loading"));$.ajax({url:"/top_containers/bulk_operations/search",data:b,type:"post",success:function(c){a.$results_container.html(c);a.setup_table_sorter();a.update_button_state()},error:function(d,f,e){var c=AS.renderTemplate("template_bulk_operation_error_message",{message:d.responseText});a.$results_container.html(c);a.update_button_state()}})};BulkContainerSearch.prototype.setup_results_list=function(b){var a=this;a.$results_container.on("click","#select_all",function(d){var c=$(this);if(c.is(":checked")){$("tbody :checkbox:not(:checked)",a.$results_container).trigger("click")}else{$("tbody :checkbox:checked",a.$results_container).trigger("click")}});a.$results_container.on("click",":checkbox",function(f){f.stopPropagation();var e=$(this);var c=e.closest("tr");c.toggleClass("selected");var d=c[0].className;if(f.altKey){c=c.prev();while(c[0]!=null&&c[0].className!=d){c.find(":checkbox").click();c=c.prev()}}a.update_button_state()});a.$results_container.on("click","td",function(c){$(this).closest("tr").find(":checkbox").trigger("click")})};BulkContainerSearch.prototype.update_button_state=function(){var b=this;var d=$("tbody :checkbox:checked",b.$results_container);var c=b.$toolbar.find(".btn");if(d.length>0){var a=$.makeArray(d.map(function(){return $(this).val()}));c.data("form-data",{record_uris:a});c.removeClass("disabled").removeAttr("disabled")}else{c.data("form-data",{});c.addClass("disabled").attr("disabled","disabled")}};BulkContainerSearch.prototype.setup_table_sorter=function(){function a(c){return(new Array(255).join("#")+c).slice(-255)}var b={selectorHeaders:"thead tr.sortable-columns th",headers:{0:{sorter:false}},sortList:[[1,0],[2,0],[4,0]],textExtraction:function(f){var d=$(f);if(d.hasClass("top-container-collection")){return d.find(".collection-identifier:first").text().trim()}else{if(d.hasClass("top-container-series")){var h=d.find(".series-level:first").text().trim();var e=d.find(".series-identifier:first").text().trim();if((h+e).length>0){return h+"-"+e}else{return""}}else{if(d.hasClass("top-container-indicator")){var g=d.text().trim();var c=g.split(/[^0-9]/)[0];return a(c)+a(g)}}}return d.text().trim()}};this.$results_container.find("table").tablesorter(b)};BulkContainerSearch.prototype.get_selection=function(){var a=this;var b=[];a.$results_container.find("tbody :checkbox:checked").each(function(c,d){b.push({uri:d.value,display_string:$(d).data("display-string"),row:$(d).closest("tr")})});return b};function BulkActionIlsHoldingUpdate(a){this.bulkContainerSearch=a;this.MENU_ID="bulkActionUpdateIlsHolding";this.setup_menu_item()}BulkActionIlsHoldingUpdate.prototype.setup_update_form=function(c){var b=this;var a=c.find("form");a.on("submit",function(d){d.preventDefault();b.perform_update(a,c)})};BulkActionIlsHoldingUpdate.prototype.perform_update=function(b,c){var a=this;$.ajax({url:"/top_containers/bulk_operations/update",data:b.serializeArray(),type:"post",success:function(d){b.replaceWith(d);c.trigger("resize")},error:function(e,g,f){var d=AS.renderTemplate("template_bulk_operation_error_message",{message:e.responseText});$("#alertBucket").replaceWith(d)}})};BulkActionIlsHoldingUpdate.prototype.setup_menu_item=function(){var a=this;a.$menuItem=$("#"+a.MENU_ID,a.bulkContainerSearch.$toolbar);a.$menuItem.on("click",function(b){a.show()})};BulkActionIlsHoldingUpdate.prototype.show=function(){var a=AS.renderTemplate("bulk_action_update_ils_holding",{selection:this.bulkContainerSearch.get_selection()});var b=AS.openCustomModal("bulkUpdateModal",this.$menuItem[0].text,a,"full");this.setup_update_form(b)};function BulkActionContainerProfileUpdate(a){this.bulkContainerSearch=a;this.MENU_ID="bulkActionUpdateContainerProfile";this.setup_menu_item()}BulkActionContainerProfileUpdate.prototype.setup_update_form=function(c){var b=this;var a=c.find("form");$(document).trigger("loadedrecordsubforms.aspace",[a]);a.on("submit",function(d){d.preventDefault();b.perform_update(a,c)})};BulkActionContainerProfileUpdate.prototype.perform_update=function(b,c){var a=this;$.ajax({url:"/top_containers/bulk_operations/update",data:b.serializeArray(),type:"post",success:function(d){b.replaceWith(d);c.trigger("resize")},error:function(e,g,f){var d=AS.renderTemplate("template_bulk_operation_error_message",{message:e.responseText});$("#alertBucket").replaceWith(d)}})};BulkActionContainerProfileUpdate.prototype.setup_menu_item=function(){var a=this;a.$menuItem=$("#"+a.MENU_ID,a.bulkContainerSearch.$toolbar);a.$menuItem.on("click",function(b){a.show()})};BulkActionContainerProfileUpdate.prototype.show=function(){var a=AS.renderTemplate("bulk_action_update_container_profile",{selection:this.bulkContainerSearch.get_selection()});var b=AS.openCustomModal("bulkUpdateModal",this.$menuItem[0].text,a,"full");this.setup_update_form(b)};function BulkActionLocationUpdate(a){this.bulkContainerSearch=a;this.MENU_ID="bulkActionUpdateLocation";this.setup_menu_item()}BulkActionLocationUpdate.prototype.setup_update_form=function(c){var b=this;var a=c.find("form");$(document).trigger("loadedrecordsubforms.aspace",[a]);a.on("submit",function(d){d.preventDefault();b.perform_update(a,c)})};BulkActionLocationUpdate.prototype.perform_update=function(b,c){var a=this;$.ajax({url:"/top_containers/bulk_operations/update",data:b.serializeArray(),type:"post",success:function(d){b.replaceWith(d);c.trigger("resize")},error:function(e,g,f){var d=AS.renderTemplate("template_bulk_operation_error_message",{message:e.responseText});$("#alertBucket").replaceWith(d)}})};BulkActionLocationUpdate.prototype.setup_menu_item=function(){var a=this;a.$menuItem=$("#"+a.MENU_ID,a.bulkContainerSearch.$toolbar);a.$menuItem.on("click",function(b){a.show()})};BulkActionLocationUpdate.prototype.show=function(){var a=AS.renderTemplate("bulk_action_update_location",{selection:this.bulkContainerSearch.get_selection()});var b=AS.openCustomModal("bulkUpdateModal",this.$menuItem[0].text,a,"full");this.setup_update_form(b)};function BulkActionMultipleLocationUpdate(a){this.bulkContainerSearch=a;this.MENU_ID="bulkActionUpdateMultipleLocation";this.setup_menu_item()}BulkActionMultipleLocationUpdate.prototype.setup_update_form=function(c){var b=this;var a=c.find("form");$(document).trigger("loadedrecordsubforms.aspace",[a]);a.ajaxForm({dataType:"html",type:"POST",beforeSubmit:function(){a.find(":submit").addClass("disabled").attr("disabled","disabled");a.find(".error").removeClass("error")},success:function(d){a.replaceWith(d);c.trigger("resize")},error:function(f,h,g){var d=$("<div>").attr("id","alertBucket").html(f.responseText);$("#alertBucket").replaceWith(d);var e=$(".alert-danger:first","#alertBucket").data("uri");if(e){$(":input[value='"+e+"']",a).closest("td").addClass("form-group").addClass("error")}a.find(":submit").removeClass("disabled").removeAttr("disabled")}})};BulkActionMultipleLocationUpdate.prototype.setup_menu_item=function(){var a=this;a.$menuItem=$("#"+a.MENU_ID,a.bulkContainerSearch.$toolbar);a.$menuItem.on("click",function(b){a.show()})};BulkActionMultipleLocationUpdate.prototype.show=function(){var a=AS.renderTemplate("bulk_action_update_location_multiple",{selection:this.bulkContainerSearch.get_selection()});var b=AS.openCustomModal("bulkUpdateModal",this.$menuItem[0].text,a,"full");this.setup_update_form(b)};function BulkActionBarcodeRapidEntry(a){this.TEMPLATE_DIALOG_ID="template_bulk_barcode_action_dialog";this.MENU_ID="showBulkActionRapidBarcodeEntry";this.bulkContainerSearch=a;this.setup_menu_item()}BulkActionBarcodeRapidEntry.prototype.setup_menu_item=function(){var a=this;a.$menuItem=$("#"+a.MENU_ID,a.bulkContainerSearch.$toolbar);a.$menuItem.on("click",function(b){a.show()})};BulkActionBarcodeRapidEntry.prototype.show=function(){var a=AS.renderTemplate(this.TEMPLATE_DIALOG_ID,{selection:this.bulkContainerSearch.get_selection()});var b=AS.openCustomModal("bulkActionBarcodeRapidEntryModal",this.$menuItem[0].text,a,"full");this.setup_keyboard_handling(b);this.setup_form_submission(b)};BulkActionBarcodeRapidEntry.prototype.setup_keyboard_handling=function(a){a.find("table :input:visible:first").focus().select();$(":input",a).on("focus",function(){$.scrollTo($(this),0,{offset:{top:400}})}).on("keypress",function(b){if(b.keyCode==13){b.stopPropagation();b.preventDefault();$(":input",$(this).closest("tr").next()).focus().select();return false}})};BulkActionBarcodeRapidEntry.prototype.setup_form_submission=function(c){var b=this;var a=c.find("form");a.ajaxForm({dataType:"html",type:"POST",beforeSubmit:function(){a.find(":submit").addClass("disabled").attr("disabled","disabled");a.find(".error").removeClass("error")},success:function(d){a.replaceWith(d);c.trigger("resize")},error:function(f,h,g){var d=$("<div>").attr("id","alertBucket").html(f.responseText);$("#alertBucket").replaceWith(d);var e=$(".alert-danger:first","#alertBucket").data("uri");if(e){$(":input[value='"+e+"']",a).closest("td").addClass("form-group").addClass("error")}a.find(":submit").removeClass("disabled").removeAttr("disabled")}})};function BulkActionDelete(c){var b=this;b.bulkContainerSearch=c;var a=$("#bulkActionDelete",b.bulkContainerSearch.$toolbar);a.on("click",function(){AS.openCustomModal("bulkActionModal","Delete Top Containers",AS.renderTemplate("bulk_action_delete",{selection:b.bulkContainerSearch.get_selection()}),"full")})}$(function(){var a=new BulkContainerSearch($("#bulk_operation_form"),$("#bulk_operation_results"),$(".record-toolbar.bulk-operation-toolbar"));new BulkActionBarcodeRapidEntry(a);new BulkActionIlsHoldingUpdate(a);new BulkActionContainerProfileUpdate(a);new BulkActionLocationUpdate(a);new BulkActionMultipleLocationUpdate(a);new BulkActionDelete(a)});